<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fina digital - Wi-Fi Ticket Payment</title>
    <!-- Tailwind CSS pour le style responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Polices Google -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- FedaPay Checkout.js -->
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }
        /* Style pour éviter le zoom sur input mobile */
        input, select, textarea { font-size: 16px; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col">

    <!-- ================= HEADER ================= -->
    <header class="py-2 px-4 bg-white shadow-sm flex items-center justify-between sticky top-0 z-40">
        <div class="flex items-center gap-3" onclick="showHome()">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg cursor-pointer">
                <i class="fas fa-wifi text-lg"></i>
            </div>
            <div class="cursor-pointer">
                <h1 class="text-xl font-bold text-gray-900 leading-tight">Fina digital</h1>
                <p class="text-xs text-gray-500 font-medium uppercase tracking-wider">Wi-Fi Haut Débit</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <!-- Ticket Button Group -->
            <div class="flex flex-col items-center">
                <button onclick="enableManualRetrieval(event)" class="bg-slate-800 text-white text-[10px] md:text-xs font-bold px-3 py-2 rounded-lg hover:bg-slate-700 transition-all shadow-md flex items-center gap-2 border border-slate-700">
                    <i class="fas fa-receipt"></i>
                    <span class="hidden sm:inline">Récupérer Ticket</span>
                    <span class="sm:hidden">Ticket ?</span>
                </button>
                <span class="text-[9px] font-bold text-indigo-600 mt-1 leading-none text-center animate-pulse">RÉCUPÉREZ VOTRE<br class="sm:hidden"> CODE ICI</span>
            </div>
            
            <!-- Help Button Group -->
            <div class="flex flex-col items-center justify-end h-full pb-1">
                <span class="text-[9px] font-bold text-gray-400 mb-1 uppercase tracking-wider leading-none">Aide</span>
                <a href="https://wa.me/22994481368" target="_blank" class="w-9 h-9 sm:w-auto sm:h-auto flex items-center justify-center text-sm font-bold text-indigo-600 bg-indigo-50 sm:px-3 sm:py-2 rounded-lg hover:bg-indigo-100 transition-colors">
                    <i class="fab fa-whatsapp sm:mr-1"></i> <span class="hidden sm:inline">Contact</span>
                </a>
            </div>
        </div>
    </header>

    <!-- ================= MAIN CONTENT (HOME) ================= -->
    <main id="home-view" class="flex-grow w-full max-w-7xl mx-auto px-4 py-8 fade-in">
        <!-- Hero Section -->
        <div class="max-w-3xl mb-10">
            <h2 class="text-3xl md:text-5xl font-black text-gray-900 tracking-tight leading-tight mb-4">
                Connectez-vous à <br />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Fina Digital Spot</span>
            </h2>
            <p class="text-gray-500 font-medium">Connexion illimitée, stable et sécurisée.</p>
        </div>

        <!-- Plans Grid -->
        <div id="plans-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-16">
            <!-- Plans will be injected here via JS -->
        </div>

        <!-- Features -->
        <section class="grid md:grid-cols-3 gap-8 py-8 border-t border-gray-100">
            <div class="flex gap-4 items-start">
                <div class="w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center text-indigo-600 shrink-0"><i class="fas fa-bolt"></i></div>
                <div><h4 class="font-bold">Ultra Rapide</h4><p class="text-xs text-gray-500">Fibre optique jusqu'à 100 Mbps.</p></div>
            </div>
            <div class="flex gap-4 items-start">
                <div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center text-green-600 shrink-0"><i class="fas fa-shield-alt"></i></div>
                <div><h4 class="font-bold">Sécurisé</h4><p class="text-xs text-gray-500">Protection de vos données.</p></div>
            </div>
            <div class="flex gap-4 items-start">
                <div class="w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center text-purple-600 shrink-0"><i class="fas fa-headset"></i></div>
                <div><h4 class="font-bold">Support 24/7</h4><p class="text-xs text-gray-500">Assistance technique disponible.</p></div>
            </div>
        </section>
    </main>

    <!-- ================= PAYMENT MODAL ================= -->
    <div id="payment-modal" class="fixed inset-0 z-50 hidden bg-slate-900/90 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen px-4 py-8 flex items-center justify-center">
            <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden relative fade-in">
                <!-- Modal Header -->
                <div class="p-6 pb-4 border-b border-gray-100 flex justify-between items-start">
                    <div>
                        <div class="inline-flex items-center gap-2 px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md text-[10px] font-black uppercase mb-2">
                            <i class="fas fa-lock"></i> Paiement Sécurisé
                        </div>
                        <h3 class="text-xl font-black text-gray-900" id="modal-plan-name">Pass Standard</h3>
                        <p class="text-indigo-600 font-bold" id="modal-plan-price">200 CFA</p>
                    </div>
                    <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Form -->
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Prénom</label>
                            <input type="text" id="firstname" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-semibold" placeholder="Jean">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Nom</label>
                            <input type="text" id="lastname" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-semibold" placeholder="Dupont">
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Email</label>
                        <input type="email" id="email" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-semibold" placeholder="email@exemple.com">
                    </div>

                    <div>
                        <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Réf. Pièce d'identité</label>
                        <input type="text" id="idReference" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-bold" placeholder="CNI / Passeport / IFU">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">WhatsApp</label>
                            <input type="tel" id="whatsapp" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-semibold" placeholder="97000000">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Mobile Money</label>
                            <input type="tel" id="phone" maxlength="8" class="w-full p-3 bg-gray-50 rounded-xl border-2 border-transparent focus:bg-white focus:border-indigo-500 outline-none text-sm font-black tracking-widest" placeholder="90909090">
                        </div>
                    </div>

                    <div class="bg-amber-50 p-3 rounded-xl border border-amber-100">
                         <p class="text-[9px] text-amber-800 italic leading-tight">
                            <i class="fas fa-info-circle mr-1"></i> Identification obligatoire selon la législation béninoise.
                        </p>
                    </div>

                    <div id="payment-error" class="hidden bg-red-50 text-red-600 p-3 rounded-xl text-xs font-bold"></div>

                    <button id="pay-btn" onclick="processPayment()" disabled class="w-full py-4 bg-gray-300 text-white font-black rounded-xl shadow-none transition-all flex items-center justify-center gap-2 mt-4 uppercase text-sm tracking-wider cursor-not-allowed">
                        Remplir le formulaire
                    </button>
                    
                    <div class="text-center mt-2">
                        <img src="https://www.fedapay.com/assets/images/logo-fedapay.png" alt="FedaPay" class="h-3 mx-auto opacity-40">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= SUCCESS / RETRIEVAL VIEW ================= -->
    <main id="success-view" class="flex-grow w-full max-w-2xl mx-auto px-4 py-8 fade-in hidden">
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
            <!-- Header Status -->
            <div id="success-header" class="py-8 flex flex-col items-center justify-center text-white bg-indigo-600">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mb-3 backdrop-blur-md">
                    <i id="status-icon" class="fas fa-check-circle text-2xl"></i>
                </div>
                <h2 id="status-title" class="text-xl font-black uppercase tracking-widest">Paiement Confirmé</h2>
                <p id="status-sub" class="opacity-80 text-xs font-bold mt-1">Génération du ticket...</p>
            </div>

            <div class="p-8">
                <!-- Loading State -->
                <div id="loading-state" class="text-center py-8">
                    <i class="fas fa-circle-notch fa-spin text-4xl text-indigo-600 mb-4"></i>
                    <p class="text-gray-500 font-medium">Récupération de votre code Wi-Fi...</p>
                </div>

                <!-- Result State -->
                <div id="result-state" class="hidden space-y-6 text-center">
                    <div class="bg-slate-50 border-2 border-dashed border-indigo-200 rounded-2xl p-6">
                        <p class="text-xs font-black text-indigo-400 uppercase tracking-widest mb-2">Code Wi-Fi</p>
                        <div class="flex items-center justify-center gap-3">
                            <span id="wifi-code-display" class="text-4xl font-black text-slate-900 tracking-tighter select-all">---</span>
                            <button onclick="copyCode()" class="w-10 h-10 bg-white text-indigo-600 rounded-xl shadow-sm border border-indigo-100 flex items-center justify-center">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600">Connectez-vous au réseau <span class="font-bold text-indigo-600">Fina Digital Spot</span> et entrez ce code.</p>

                    <button onclick="window.location.href='http://fina.spot/'" class="w-full py-4 bg-indigo-600 text-white font-black rounded-xl shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-wifi"></i> SE CONNECTER
                    </button>
                </div>

                <!-- Manual Input State (Error or Manual Mode) -->
                <div id="manual-state" class="hidden pt-4 border-t border-gray-100 mt-4">
                    <p class="text-sm font-bold text-gray-700 mb-2">Entrez votre ID de transaction :</p>
                    <div class="flex gap-2">
                        <input type="text" id="manual-id-input" class="flex-1 p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-indigo-500" placeholder="Ex: 123456">
                        <button onclick="fetchManualCode()" class="px-4 bg-gray-800 text-white font-bold rounded-xl text-sm">Récupérer</button>
                    </div>
                    <p id="manual-error" class="text-xs text-red-500 font-bold mt-2 hidden"></p>
                </div>

                <button onclick="showHome()" class="w-full mt-6 py-3 text-gray-400 font-bold text-xs uppercase tracking-widest hover:text-gray-600">
                    Retour à l'accueil
                </button>
            </div>
        </div>
    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="py-8 bg-white border-t border-gray-100 mt-auto">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
            <div class="opacity-50 text-sm">
                <i class="fas fa-wifi mr-1"></i> <span class="font-bold">Fina digital © 2026</span>
            </div>
            <div class="flex flex-wrap justify-center gap-4 text-xs font-bold text-gray-400">
                <a href="https://urlr.me/!CGV-FDS" target="_blank" class="hover:text-indigo-600">CGV</a>
                <a href="https://urlr.me/!POLITIQUE-CONFIDENTIALITE-FDS" target="_blank" class="hover:text-indigo-600">Politique de Confidentialité</a>
            </div>
            <div class="flex items-center gap-3">
                <a href="https://www.instagram.com/finadigitalspot?igsh=d2p2M2Mydmo4aHNy" target="_blank" class="w-8 h-8 bg-gray-50 rounded-full flex items-center justify-center text-gray-400 hover:text-pink-600 transition-colors">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- ================= LOGIC ================= -->
    <script>
        // CONFIGURATION
        const FEDAPAY_PUBLIC_KEY = "pk_live_MPRF2l_yxwIGWPVpR0-c3eIY";
        const WEBHOOK_DATA = "https://themislab-n8n.okrh4i.easypanel.host/webhook/DATA";
        const WEBHOOK_CODE = "https://themislab-n8n.okrh4i.easypanel.host/webhook/3de9d75a-cb72-429e-a14b-a71fb619e9a4";

        const PASSES = [
            { id: 'pass-100', price: 100, label: 'Basic Pass', duration: '3 Heures', icon: 'fa-bolt', color: 'text-blue-500 bg-blue-50' },
            { id: 'pass-150', price: 150, label: 'Social Pass', duration: '8 Heures', icon: 'fa-users', color: 'text-indigo-500 bg-indigo-50' },
            { id: 'pass-200', price: 200, label: 'Standard Pass', duration: '12 Heures', icon: 'fa-wifi', color: 'text-purple-500 bg-purple-50' },
            { id: 'pass-300', price: 300, label: 'Streamer Pass', duration: '24 Heures', icon: 'fa-play', color: 'text-pink-500 bg-pink-50' },
            { id: 'pass-500', price: 500, label: 'Unlimited Day', duration: '48 Heures', icon: 'fa-crown', color: 'text-amber-500 bg-amber-50' }
        ];

        let selectedPass = null;
        let formValid = false;

        // INIT APP
        document.addEventListener('DOMContentLoaded', () => {
            renderPlans();
            setupFormListeners();
        });

        // RENDER PLANS
        function renderPlans() {
            const container = document.getElementById('plans-container');
            container.innerHTML = PASSES.map(pass => `
                <div onclick="selectPass('${pass.id}')" class="bg-white p-5 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md hover:border-indigo-200 transition-all cursor-pointer active:scale-95 group">
                    <div class="flex justify-between items-start mb-3">
                        <div class="w-10 h-10 ${pass.color} rounded-xl flex items-center justify-center mb-2">
                            <i class="fas ${pass.icon} text-lg"></i>
                        </div>
                        <span class="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded-full uppercase">${pass.duration}</span>
                    </div>
                    <h3 class="font-bold text-gray-900">${pass.label}</h3>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span class="text-2xl font-black text-indigo-600">${pass.price}</span>
                        <span class="text-xs font-bold text-gray-400">CFA</span>
                    </div>
                </div>
            `).join('');
        }

        // NAVIGATION
        function showHome() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('success-view').classList.add('hidden');
            closeModal();
        }

        function showSuccessView(isManual = false) {
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('payment-modal').classList.add('hidden');
            const view = document.getElementById('success-view');
            view.classList.remove('hidden');

            const header = document.getElementById('success-header');
            const icon = document.getElementById('status-icon');
            
            if (isManual) {
                header.className = "py-8 flex flex-col items-center justify-center text-white bg-gray-800";
                icon.className = "fas fa-search text-2xl";
                document.getElementById('status-title').innerText = "Récupération";
                document.getElementById('status-sub').innerText = "Entrez votre ID";
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('result-state').classList.add('hidden');
                document.getElementById('manual-state').classList.remove('hidden');
            } else {
                header.className = "py-8 flex flex-col items-center justify-center text-white bg-indigo-600";
                icon.className = "fas fa-check-circle text-2xl";
                document.getElementById('status-title').innerText = "Paiement Réussi";
                document.getElementById('status-sub').innerText = "Génération du ticket...";
                document.getElementById('loading-state').classList.remove('hidden');
                document.getElementById('result-state').classList.add('hidden');
                document.getElementById('manual-state').classList.add('hidden');
            }
        }

        // MODAL LOGIC
        function selectPass(id) {
            selectedPass = PASSES.find(p => p.id === id);
            if (!selectedPass) return;

            document.getElementById('modal-plan-name').innerText = selectedPass.label;
            document.getElementById('modal-plan-price').innerText = selectedPass.price + ' CFA';
            
            document.getElementById('payment-modal').classList.remove('hidden');
            validateForm(); // Check validation immediately
        }

        function closeModal() {
            document.getElementById('payment-modal').classList.add('hidden');
        }

        // FORM VALIDATION
        function setupFormListeners() {
            const inputs = ['firstname', 'lastname', 'email', 'idReference', 'whatsapp', 'phone'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', validateForm);
            });
        }

        function validateForm() {
            const firstname = document.getElementById('firstname').value.trim();
            const lastname = document.getElementById('lastname').value.trim();
            const email = document.getElementById('email').value.trim();
            const idRef = document.getElementById('idReference').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            const phone = document.getElementById('phone').value.trim();

            const isValid = firstname && lastname && email.includes('@') && idRef && whatsapp.length >= 8 && phone.length === 8;
            
            const btn = document.getElementById('pay-btn');
            if (isValid) {
                btn.removeAttribute('disabled');
                btn.classList.remove('bg-gray-300', 'cursor-not-allowed', 'shadow-none');
                btn.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'shadow-lg');
                btn.innerHTML = `Payer ${selectedPass ? selectedPass.price : ''} CFA <i class="fas fa-arrow-right ml-2"></i>`;
                formValid = true;
            } else {
                btn.setAttribute('disabled', 'true');
                btn.classList.add('bg-gray-300', 'cursor-not-allowed', 'shadow-none');
                btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'shadow-lg');
                btn.innerText = "Remplir tous les champs";
                formValid = false;
            }
        }

        // PAYMENT PROCESS
        function processPayment() {
            if (!formValid || !selectedPass) return;

            const customer = {
                firstname: document.getElementById('firstname').value,
                lastname: document.getElementById('lastname').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                idRef: document.getElementById('idReference').value,
                wa: document.getElementById('whatsapp').value
            };

            if (window.FedaPay) {
                try {
                    window.FedaPay.init({
                        public_key: FEDAPAY_PUBLIC_KEY,
                        transaction: {
                            amount: selectedPass.price,
                            description: `WiFi Fina: ${selectedPass.label}`
                        },
                        customer: {
                            firstname: customer.firstname,
                            lastname: customer.lastname,
                            email: customer.email,
                            phone_number: { number: customer.phone, country: 'BJ' }
                        },
                        onComplete: async (resp) => {
                            if (resp.transaction && resp.transaction.status === 'approved') {
                                // Save Data Async
                                saveData(customer, selectedPass, resp.transaction.id);
                                // Move to success
                                showSuccessView(false);
                                fetchWifiCode(resp.transaction.id);
                            } else if (resp.transaction && resp.transaction.status !== 'canceled') {
                                alert("Paiement échoué ou annulé.");
                            }
                        }
                    });
                    // Note: FedaPay checkout js usually attaches to a button or opens immediately depending on config.
                    // Since we are inside the onclick, we might need to trigger open() if init doesn't auto-open
                    // However, the standard implementation usually involves `FedaPay.init(selector, options)`.
                    // Let's use the object open method if available or re-init on a hidden button.
                    
                    // Fallback specific for dynamic JS triggering if needed:
                     /* 
                       Since simple html implementation might differ from react wrapper, 
                       we will rely on the standard `FedaPay.init` behavior which opens the dialog.
                     */
                } catch (e) {
                    console.error("FedaPay Error", e);
                    alert("Erreur d'initialisation du paiement.");
                }
            } else {
                alert("Erreur: Module de paiement non chargé. Vérifiez votre connexion.");
            }
        }

        async function saveData(customer, pass, txId) {
            try {
                fetch(WEBHOOK_DATA, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        firstname: customer.firstname,
                        lastname: customer.lastname,
                        email: customer.email,
                        phone: customer.phone,
                        id_reference: customer.idRef,
                        whatsapp_number: customer.wa,
                        transaction_id: txId,
                        amount: pass.price,
                        plan: pass.label,
                        date: new Date().toISOString()
                    })
                });
            } catch (e) { console.error("Save error", e); }
        }

        // FETCH WIFI CODE
        async function fetchWifiCode(txId, attempt = 0) {
            try {
                const response = await fetch(WEBHOOK_CODE, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ transaction_id: txId.toString() })
                });

                if (response.ok) {
                    const text = await response.text();
                    let code = null;
                    try {
                        const json = JSON.parse(text);
                        code = json.code_wifi || json.wifi_code || json.code || json.ticket || (typeof json === 'string' ? json : null);
                    } catch {
                        code = text.trim();
                    }

                    if (code && code !== '{{ $json.output }}' && code.length > 2) {
                        displayCode(code);
                    } else {
                        throw new Error("Code invalid");
                    }
                } else {
                    throw new Error("Server error");
                }
            } catch (e) {
                if (attempt < 4) {
                    setTimeout(() => fetchWifiCode(txId, attempt + 1), 3000);
                } else {
                    // Fallback to manual mode UI with error
                    document.getElementById('loading-state').classList.add('hidden');
                    document.getElementById('manual-state').classList.remove('hidden');
                    document.getElementById('manual-id-input').value = txId;
                    document.getElementById('manual-error').innerText = "Délai dépassé. Cliquez sur 'Récupérer' pour réessayer.";
                    document.getElementById('manual-error').classList.remove('hidden');
                }
            }
        }

        function displayCode(code) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('manual-state').classList.add('hidden');
            document.getElementById('result-state').classList.remove('hidden');
            document.getElementById('wifi-code-display').innerText = code;
        }

        // MANUAL RETRIEVAL
        function enableManualRetrieval(e) {
            e.preventDefault();
            showSuccessView(true);
        }

        function fetchManualCode() {
            const id = document.getElementById('manual-id-input').value.trim();
            if (!id) return;
            
            document.getElementById('manual-error').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('manual-state').classList.add('hidden');
            
            fetchWifiCode(id);
        }

        function copyCode() {
            const code = document.getElementById('wifi-code-display').innerText;
            navigator.clipboard.writeText(code);
            alert("Code copié !");
        }
    </script>
</body>
</html>
